import{r as p,t as S,d as w,e as N,f as k,o as R,v as F,w as C,h as P,j as e}from"./index-CO07VfhB.js";import{u as H,a as B,I as c,A as O}from"./Input-bEMIZj4K.js";import{H as T,R as I,C as D,F as L,S as U}from"./Heading-DsbmKIAi.js";import{a as V}from"./warning-Dz1zIpaj.js";import"./CloseButton-A6JS-OX6.js";const $=()=>{const[a,r]=p.useState("idle"),[s,l]=p.useState(null);return{emailAvailabilityStatus:a,checkEmailAvailability:async t=>{l(t),r("checking");try{(await S.get(`/users?email=${t}`)).data.length?r("notAvailable"):r("available")}catch(i){r("failed"),console.log(i)}},resetCheckEmailAvailability:()=>{r("idle"),l(null)},prevEnteredEmail:s}},z=()=>{const a=w(),r=N(),{loading:s,error:l}=k(m=>m.auth),{checkEmailAvailability:n,emailAvailabilityStatus:o,prevEnteredEmail:t,resetCheckEmailAvailability:i}=$(),{register:h,handleSubmit:b,trigger:f,getFieldState:v,formState:{errors:y,isValid:E}}=H({mode:"onBlur",shouldFocusError:!0,resolver:B(F)}),x=async m=>{const{firstName:d,lastName:u,email:g,password:j}=m;a(C({firstName:d,lastName:u,email:g,password:j})).unwrap().then(()=>r(`${P.LOGIN}?msg=registration_successful`))},A=async m=>{await f("email");const d=m.target.value,{isDirty:u,invalid:g}=v("email");u&&!g&&d!==t&&n(d),u&&g&&t&&i()};return p.useEffect(()=>()=>{a(R())},[a]),{loading:s,error:l,emailAvailabilityStatus:o,formErrors:y,isValid:E,register:h,handleSubmit:b,submitHandler:x,emailOnBlurHandler:A}},K=()=>{const{register:a,handleSubmit:r,formErrors:s,isValid:l,loading:n,error:o,submitHandler:t,emailAvailabilityStatus:i,emailOnBlurHandler:h}=z();return e.jsxs("section",{children:[e.jsx(T,{title:"User Registration"}),e.jsx(I,{className:"my-2",children:e.jsx(D,{md:{span:6,offset:3},children:e.jsxs(L,{onSubmit:r(t),children:[e.jsx(c,{label:"First Name",name:"firstName",register:a,error:s.firstName?.message||"",autoFocus:!0}),e.jsx(c,{label:"Last Name",name:"lastName",register:a,error:s.lastName?.message||""}),e.jsx(c,{label:"Email Address",name:"email",register:a,onBlur:h,error:s.email?.message?s.email?.message:i==="notAvailable"?"This email is already in use.":i==="failed"?"Error from the server.":"",formText:i==="checking"?"We're currently checking the availability of this email address. Please wait a moment.":"",success:i==="available"?"This email is available for use.":"",disabled:i==="checking"}),e.jsx(c,{label:"Password",name:"password",type:"password",register:a,error:s.password?.message||""}),e.jsx(c,{label:"Confirm Password",name:"confirmPassword",type:"password",register:a,error:s.confirmPassword?.message||""}),e.jsx(V,{disabled:!l||n==="pending",variant:"info",type:"submit",style:{color:"white"},children:n==="pending"?e.jsxs(e.Fragment,{children:[e.jsx(U,{as:"span",animation:"border",size:"sm",role:"status","aria-hidden":"true"}),e.jsx("span",{className:"ms-2",children:"Registering..."})]}):"Register"}),o&&e.jsxs(O,{variant:"danger mt-2",children:[" ",o," "]})]})})})]})};export{K as default};
