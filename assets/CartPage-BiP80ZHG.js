import{j as e,b as f,e as y,r as p,E as S,F as b,G as F,H,I,J as O,K as w,M as g,L as E,g as P}from"./index-BP77i2Bk.js";import{C as v,u as A,L}from"./CartItem-BeIecfIt.js";import{H as k}from"./Heading-B4wgSNhp.js";import{e as l}from"./Modal-BJUEWCMO.js";import{B as h}from"./Button-DoyuUPbG.js";import{S as G}from"./Spinner-BBW5ju7R.js";import"./Row-gmytxdi1.js";import"./CloseButton-Bswu-Ih9.js";import"./useEventCallback-DxQmx_i4.js";import"./useMergedRefs-C1VBZkls.js";import"./warning-xdCFWgwQ.js";const M=({products:t,onChangeQuantity:n,onRemoveItem:o})=>{const s=t.map(a=>e.jsx(v,{...a,onChangeQuantity:n,onRemoveItem:o},a.id));return e.jsx(e.Fragment,{children:s})},q="_container_ptx4s_1",C={container:q},B=({products:t})=>{const n=f(),{requireAuth:o}=A(),{loading:s,error:a}=y(m=>m.orders),[i,d]=p.useState(!1),c=t.reduce((m,u)=>u.quantity&&typeof u.quantity=="number"?m+u.price*u.quantity:m,0),x=()=>{o(()=>{d(!0)})},r=()=>{d(!1)},j=()=>{n(S(c)).unwrap().then(()=>{n(b())}),r()};return e.jsxs(e.Fragment,{children:[e.jsxs(l,{show:i,onHide:r,backdrop:"static",children:[e.jsx(l.Header,{closeButton:!0,children:e.jsx(l.Title,{children:"Placing Order"})}),e.jsxs(l.Body,{children:["Are you sure you want to place order with Subtotal:",c.toFixed(2)," EGP",!s&&a&&e.jsx("p",{style:{color:"#DC3545",marginTop:"10px"},children:a})]}),e.jsxs(l.Footer,{children:[e.jsx(h,{variant:"secondary",onClick:r,children:"Close"}),e.jsx(h,{variant:"info",style:{color:"white"},onClick:j,disabled:s==="pending",children:s==="pending"?e.jsxs(e.Fragment,{children:[e.jsx(G,{animation:"border",size:"sm"})," Loading..."]}):"Confirm"})]})]}),e.jsxs("section",{className:C.container,children:[e.jsx("span",{children:"Subtotal:"}),e.jsxs("span",{children:[" ",c.toFixed(2)," EGP"]})]}),e.jsxs("section",{className:C.container,children:[e.jsx("span",{}),e.jsx("span",{children:e.jsx(h,{variant:"primary",style:{color:"white"},onClick:x,children:"Place Order"})})]})]})},N=()=>{const t=f(),{items:n,productsFullInfo:o,loading:s,error:a}=y(r=>r.cart),i=y(r=>r.orders.loading),d=o.map(r=>({...r,quantity:n[r.id]})),c=p.useCallback((r,j)=>{t(F({id:r,quantity:j}))},[t]),x=p.useCallback(r=>{t(H(r))},[t]);return p.useEffect(()=>{const r=t(I());return()=>{r.abort(),t(O()),t(w())}},[t]),{products:d,loading:s,error:a,placeOrderStatus:i,changeQuantityHandler:c,removeItemHandler:x}},W=()=>{const{products:t,loading:n,error:o,placeOrderStatus:s,changeQuantityHandler:a,removeItemHandler:i}=N();return e.jsxs(e.Fragment,{children:[e.jsx(k,{title:"Your Cart"}),e.jsx(L,{loading:n,error:o,type:"cart",children:t.length?e.jsxs(e.Fragment,{children:[e.jsx(M,{products:t,onChangeQuantity:a,onRemoveItem:i}),e.jsx(B,{products:t})]}):s==="succeeded"?e.jsx(g,{type:"success",message:"Order Placed Successfully!"}):e.jsxs(e.Fragment,{children:[e.jsx(g,{type:"empty",message:"Your cart is empty"}),e.jsx(E,{to:P.CATEGORIES,className:"d-flex justify-content-center",children:e.jsx(h,{variant:"primary",className:"my-2",children:"Shop Now"})})]})})]})};export{W as default};
