import{r as p,o as w,h as S,d as N,e as k,l as R,j as e,p as F,q as C,f as P}from"./index-wnTk3KwH.js";import{u as B,a as H,I as m,A as T}from"./Input-CVWmnVlq.js";import{H as I,R as O,C as D,F as L,S as U}from"./Heading-RtEnZzgB.js";import{a as $}from"./warning-DFf_0RsR.js";import"./CloseButton-B0Lxnf2W.js";const q=()=>{const[t,a]=p.useState("idle"),[c,r]=p.useState(null);return{emailAvailabilityStatus:t,checkEmailAvailability:async l=>{r(l),a("checking");try{(await w.get(`/users?email=${l}`)).data.length?a("notAvailable"):a("available")}catch(d){a("failed"),console.log(d)}},resetCheckEmailAvailability:()=>{a("idle"),r(null)},prevEnteredEmail:c}},J=()=>{const t=S(),a=N(),{loading:c,error:r}=k(o=>o.auth),{checkEmailAvailability:f,emailAvailabilityStatus:s,prevEnteredEmail:l,resetCheckEmailAvailability:d}=q(),{register:n,handleSubmit:b,trigger:v,getFieldState:y,formState:{errors:i,isValid:x}}=B({mode:"onBlur",shouldFocusError:!0,resolver:H(F)}),E=async o=>{const{firstName:u,lastName:h,email:g,password:j}=o;t(C({firstName:u,lastName:h,email:g,password:j})).unwrap().then(()=>a(`${P.LOGIN}?msg=registration_successful`))},A=async o=>{await v("email");const u=o.target.value,{isDirty:h,invalid:g}=y("email");h&&!g&&u!==l&&f(u),h&&g&&l&&d()};return p.useEffect(()=>()=>{t(R())},[t]),e.jsxs("section",{children:[e.jsx(I,{title:"User Registration"}),e.jsx(O,{className:"my-2",children:e.jsx(D,{md:{span:6,offset:3},children:e.jsxs(L,{onSubmit:b(E),children:[e.jsx(m,{label:"First Name",name:"firstName",register:n,error:i.firstName?.message||"",autoFocus:!0}),e.jsx(m,{label:"Last Name",name:"lastName",register:n,error:i.lastName?.message||""}),e.jsx(m,{label:"Email Address",name:"email",register:n,onBlur:A,error:i.email?.message?i.email?.message:s==="notAvailable"?"This email is already in use.":s==="failed"?"Error from the server.":"",formText:s==="checking"?"We're currently checking the availability of this email address. Please wait a moment.":"",success:s==="available"?"This email is available for use.":"",disabled:s==="checking"}),e.jsx(m,{label:"Password",name:"password",type:"password",register:n,error:i.password?.message||""}),e.jsx(m,{label:"Confirm Password",name:"confirmPassword",type:"password",register:n,error:i.confirmPassword?.message||""}),e.jsx($,{disabled:!x||c==="pending",variant:"info",type:"submit",style:{color:"white"},children:c==="pending"?e.jsxs(e.Fragment,{children:[e.jsx(U,{as:"span",animation:"border",size:"sm",role:"status","aria-hidden":"true"}),e.jsx("span",{className:"ms-2",children:"Registering..."})]}):"Register"}),r&&e.jsxs(T,{variant:"danger mt-2",children:[" ",r," "]})]})})})]})};export{J as default};
